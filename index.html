<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mounjaro 格數 ↔ 劑量換算（含快速鍵）</title>
<style>
  body{font-family:Arial,"Microsoft JhengHei",sans-serif;background:#0f172a;color:#e5e7eb;margin:0;padding:20px}
  h1{color:#a855f7;margin:0 0 10px}
  .card{background:#111827;border-radius:12px;padding:16px;margin-top:12px;border:1px solid #1f2937}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  select,input{padding:10px;border-radius:8px;border:1px solid #374151;background:#1f2937;color:#fff}
  button{padding:10px 14px;border-radius:8px;border:0;background:linear-gradient(90deg,#10b981,#22d3ee);color:#052e2b;font-weight:700;cursor:pointer}
  .btn-ghost{background:#1f2937;color:#e5e7eb;border:1px dashed #374151}
  .quick{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .result{font-size:20px;font-weight:800;margin-top:10px}
  .hint{color:#9ca3af;font-size:12px;margin-top:6px}
</style>
</head>
<body>
  <h1>Mounjaro 格數 ↔ 劑量換算</h1>

  <!-- 格數 -> 劑量 -->
  <div class="card">
    <h2 style="margin:0 0 8px">1) 輸入格數 → 算劑量</h2>
    <div class="row">
      <label>格數：</label>
      <input id="ticks" type="number" min="0" step="1" placeholder="輸入格數" />
      <label>筆型：</label>
      <select id="pen1">
        <option value="2.5">2.5 mg 筆</option>
        <option value="5">5.0 mg 筆</option>
        <option value="7.5">7.5 mg 筆</option>
        <option value="10">10.0 mg 筆</option>
        <option value="12.5">12.5 mg 筆</option>
        <option value="15">15.0 mg 筆</option>
      </select>
      <button id="btnDose">計算</button>
    </div>
    <div class="result" id="doseOut">—</div>
    <div class="hint">劑量 = 格數 × (筆針總劑量 ÷ 60)。超過 60 格不可使用。</div>
  </div>

  <!-- 劑量 -> 格數 -->
  <div class="card">
    <h2 style="margin:0 0 8px">2) 輸入劑量 → 算格數</h2>
    <div class="row">
      <label>劑量 (mg)：</label>
      <input id="mg" type="number" min="0" step="0.001" placeholder="例如 7.5" />
      <label>筆型：</label>
      <select id="pen2">
        <option value="2.5">2.5 mg 筆</option>
        <option value="5">5.0 mg 筆</option>
        <option value="7.5">7.5 mg 筆</option>
        <option value="10">10.0 mg 筆</option>
        <option value="12.5">12.5 mg 筆</option>
        <option value="15">15.0 mg 筆</option>
      </select>
      <button id="btnTicks">計算</button>
      <button id="btnSwap" class="btn-ghost" title="左右互換">左右互換</button>
    </div>

    <!-- 快速劑量按鈕 -->
    <div class="quick" id="quickRow">
      <!-- 會由 JS 產生 2.5 / 5 / 7.5 / 10 / 12.5 / 15 mg 快速鍵 -->
    </div>

    <div class="result" id="tickOut">—</div>
    <div class="result" id="halfOut">—</div>
    <div class="hint">格數一律「無條件捨去」。若結果 > 60 格，僅顯示「超過 60 格，不可使用」。</div>
  </div>

<script>
const TOTAL_TICKS = 60;
const QUICK_DOSES = [2.5, 5, 7.5, 10, 12.5, 15];

// 產生快速鍵
const quickRow = document.getElementById('quickRow');
QUICK_DOSES.forEach(v=>{
  const b = document.createElement('button');
  b.className = 'btn-ghost';
  b.textContent = v + ' mg';
  b.addEventListener('click', ()=>{
    document.getElementById('mg').value = v;
    calcTicks(); // 一鍵帶入後自動計算
  });
  quickRow.appendChild(b);
});

// 格數 -> 劑量
function calcDose(){
  const ticks = parseFloat(document.getElementById("ticks").value);
  const pen = parseFloat(document.getElementById("pen1").value);
  const out = document.getElementById("doseOut");
  if(isNaN(ticks) || ticks < 0){ out.textContent="請輸入正確格數"; return; }
  if(ticks > TOTAL_TICKS){ out.textContent="超過 60 格，不可使用"; return; }
  const mg = ticks * (pen / TOTAL_TICKS);
  out.textContent = `劑量 ≈ ${mg.toFixed(3)} mg`;
}

// 劑量 -> 格數（含 0.5 mg）
function calcTicks(){
  const mg = parseFloat(document.getElementById("mg").value);
  const pen = parseFloat(document.getElementById("pen2").value);
  const out = document.getElementById("tickOut");
  const halfOut = document.getElementById("halfOut");
  if(isNaN(mg) || mg < 0){ out.textContent="請輸入正確劑量"; halfOut.textContent=""; return; }

  const rawTicks = mg * (TOTAL_TICKS / pen);
  const ticks = Math.floor(rawTicks); // 無條件捨去
  if(ticks > TOTAL_TICKS){
    out.textContent = `${mg} mg 超過 60 格，不可使用`;
    halfOut.textContent = "";
    return;
  }
  const halfTicks = Math.floor(0.5 * (TOTAL_TICKS / pen));
  out.textContent = `${mg} mg 需要：${ticks} 格`;
  halfOut.textContent = `0.5 mg 需要：${halfTicks} 格`;
}

// 左右互換：把兩區的輸入值/選擇對調
function swapSides(){
  // 將「劑量→格數」區的筆型與劑量，與「格數→劑量」區的筆型與格數互換輸入
  const pen1 = document.getElementById('pen1');
  const pen2 = document.getElementById('pen2');
  const ticks = document.getElementById('ticks');
  const mg = document.getElementById('mg');

  // 臨時儲存
  const tPen = pen1.value, tTicks = ticks.value;
  pen1.value = pen2.value; pen2.value = tPen;
  ticks.value = Math.floor(parseFloat(mg.value || "0") * (TOTAL_TICKS / parseFloat(pen2.value||"2.5"))) || "";
  mg.value = (parseFloat(tTicks||"") * (parseFloat(tPen||"2.5") / TOTAL_TICKS) || "").toString();

  // 重新計算
  calcDose();
  calcTicks();
}

// 綁定事件
document.getElementById('btnDose').addEventListener('click', calcDose);
document.getElementById('btnTicks').addEventListener('click', calcTicks);
document.getElementById('btnSwap').addEventListener('click', swapSides);

// Enter 快捷鍵
document.getElementById('ticks').addEventListener('keydown', e=>{ if(e.key==='Enter') calcDose(); });
document.getElementById('mg').addEventListener('keydown', e=>{ if(e.key==='Enter') calcTicks(); });

// 初始顯示
document.getElementById('doseOut').textContent = '—';
document.getElementById('tickOut').textContent = '—';
document.getElementById('halfOut').textContent = '—';
</script>
</body>
</html>
